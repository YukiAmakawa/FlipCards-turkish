<!DOCTYPE html>
<html>
<head>
    <title>FlipCards</title>
    <META charset="UTF-8">
    </META>
</head>

<body onload="init()">
    <table id="table"></table>
</body>
<style>
    table {
        margin-left:auto;
        margin-right:auto;
    }

    td.card {
        width: 100px;
        height: 140px;
        border: 1px solid gray;
        border-radius: 10px;
        text-align: center;
        font-size: 36px;
        font-weight: bold;
        background-color: white;
        background-repeat: no-repeat;
    }

    td.back {
        background-image: url("card.png");
        background-size: 100px 140px;
    }

    .animal0 {
        background-image: url("animal0.png")
    }

    .animal1 {
        background-image: url("animal1.png")
    }

    .animal2 {
        background-image: url("animal2.png")
    }

    .animal3 {
        background-image: url("animal3.png")
    }

    .animal4 {
        background-image: url("animal4.png")
    }

    .animal5 {
        background-image: url("animal5.png")
    }

    .animal6 {
        background-image: url("animal6.png")
    }

    .animal7 {
        background-image: url("animal7.png")
    }

    .animal8 {
        background-image: url("animal8.png")
    }

    .animal9 {
        background-image: url("animal9.png")
    }

    .animal10 {
        background-image: url("animal10.png")
    }

    .animal11 background-image: url("animal11.png")
    }

    .animal12 {
        background-image: url("animal12.png")
    }

    .animal13 {
        background-image: url("animal13.png")
    }

    .animal14 {
        background-image: url("animal14.png")
    }

    .animal15 {
        background-image: url("animal15.png")
    }

    .animal16 {
        background-image: url("animal16.png")
    }

    .animal17 {
        background-image: url("animal17.png")
    }

    .animal18 {
        background-image: url("animal18.png")
    }

    .animal19 {
        background-image: url("animal19.png")
    }
</style>
<script>
    //配列シャッフル
    //shuffleは配列Arrayのプロトタイプ（ひな型）、Arrayのひな型から作られたインスタンス（var cards = []など）はそのプロトタイプメソッドであるshuffleを使用できる
    Array.prototype.shuffle = function() {
        //配列の長さ1-20と要素の数えかた0-19は異なる
        var i = this.length;
        //whileの中は条件文のみ
        //(i)はiが値を保持している限り、つまり[--i]を繰り返してi==0になるまで
        while (i) {
            //ここからカードを順番にswap 
            //0-19の中からランダムで値を得る
            var j = Math.floor(Math.random() * i);
            //配列の（randomで得られた値）番目の値がtとなる　iは1－20の中から選ばれるが、配列は0－19番目までなので先にi-1をする
            　　 //--iは代入前に引く　i--は代入後
            var t = this[--i];
            //↓この[i]は↑の[--i]と同じ（処理前に引いているから）
            this[i] = this[j];
            this[j] = t;
        }
        return this;
    }


    //NaN=not a number 数字ではない
    var timer = NaN;
    var score = 0;
    var flipTimer;
    var prevCard;
    var startTime;
    var pic = [];

    function init() {
        var table = document.getElementById("table");
        var cards = [];
        for (var i = 0; i < 20; i++) {
            cards.push(i);
        }
        cards.shuffle();

        for (var i = 0; i < 4; i++) {
            var tr = document.createElement("tr");
            for (var j = 0; j < 5; j++) {
                var td = document.createElement("td");
                td.className = "card back";
                //cards[]の0番目から19番目
                //tdにnumberを割り振っていく
                td.number = cards[i * 5 + j];
                td.onclick = flip;
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
    }



    function flip(e) {
        //クリックされたカードのこと
        var curCard = this;
        var num = this.number;
        //classをcardにしてトランプの裏面の絵を消す＝文字や絵が見えるようにする
        //animal numにして動物の絵をいれる
        this.className = "card animal" + num;
        //カードが1枚目の時は、curCardとprevCardに今クリックしたカード（イベントが発生したオブジェクト）を代入
        if (prevCard == null) {
            prevCard = this;
            return;
        }
        //2枚目
        if (prevCard.number == num - 10 || prevCard.number == num + 10) {
            //numとnum-10、numとnum＋10がセットになっている
            //2枚目のカードを開いたことでscoreが10になったら＝すべてカードがそろったら
            if (++score == 10) {
                //経過時間のタイマーを止める
                clearInterval(timer);
            }
            //2枚目のカードが同じだがまだすべてそろっていない
            //prevCardに入っている1枚目のカードの情報をリセット
            prevCard = null;
            clearTimeout(flipTimer);
            //カードが揃っていない
        } else {
            flipTimer = setTimeout(function() {
　　　　　　　　   //back にして裏面に戻す　カードの形式は維持するのでcardはそのまま
                //1枚目も同様
                curCard.className = "card back";
                prevCard.className = "card back";
                //prevcardをリセット
                prevCard = null;
                curCard = null;
                //flipTimerが値を保持している間は何も処理できないようになっているので、NaNを入れてリセット
                flipTimer = NaN;
            }, 1000);
        }
    }
</script>

</html>
